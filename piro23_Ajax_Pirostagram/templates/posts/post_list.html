{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1 class="title">Pirostagram</h1>

<div style="margin-bottom: 20px;">
    <a href="{% url 'posts:post_create' %}" class="button is-primary">+ 게시물 올리기</a>
</div>

<div id="post-list">
    {% for post in posts %}
    <div class="post box" data-post-id="{{ post.id }}">
        <p><strong>{{ post.user.username }}</strong></p>
        <img src="{{ post.image.url }}" alt="post image" width="300px" style="margin: 10px 0;">
        <p>{{ post.content }}</p>

        <!-- 좋아요 -->
        <button class="like-btn button is-light" data-post-id="{{ post.id }}">
            ❤️ <span class="like-count">{{ post.likes.count }}</span>
        </button>

        <!-- 댓글 리스트 -->
        <div class="comments" style="margin-top:10px;">
            {% for comment in post.comments.all %}
            <div class="comment" data-comment-id="{{ comment.id }}">
                <strong>{{ comment.user.username }}</strong>: {{ comment.content }}
                {% if comment.user == request.user %}
                <button class="delete-comment-btn button is-small is-danger is-light" data-comment-id="{{ comment.id }}" style="margin-left:5px;">❌</button>
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <!-- 댓글 작성 폼 -->
        <form class="add-comment-form" data-post-id="{{ post.id }}" style="margin-top:10px;">
            {% csrf_token %}
            <input type="text" name="content" placeholder="댓글 달기..." required style="width: 70%;">
            <button type="submit" class="button is-small is-link">게시</button>
        </form>
    </div>
    <hr>
    {% endfor %}
</div>

{% endblock %}